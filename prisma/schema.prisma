// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
}

// --- Models ---

model User {
  id          Int      @id @default(autoincrement()) @map("user_id")
  role        Role     @default(USER)
  email       String   @unique @db.VarChar(50)
  password    String   @db.VarChar(255)
  fullName    String?  @map("full_name") @db.VarChar(100)
  phone       String?  @db.VarChar(15)
  moneySpent  Decimal  @default(0.00) @map("money_spent") @db.Decimal(15, 2)
  createdAt   DateTime @default(now()) @map("created_at")

  // Relations
  carts       Cart[]
  orders      Order[]

  @@map("users")
}

enum Role {
  USER  @map("user")
  ADMIN @map("admin")
}

model Product {
  id          Int      @id @default(autoincrement()) @map("product_id")
  name        String   @db.VarChar(150)
  price       Decimal  @db.Decimal(12, 2)
  description String?  @db.Text
  quantity    Int      @default(0)
  imageUrl    String?  @map("image_url") @db.Text
  createdAt   DateTime @default(now()) @map("created_at")

  // Relations
  cartItems    CartItem[]
  orderDetails OrderDetail[]

  @@map("products")
}

model Cart {
  id        Int      @id @default(autoincrement()) @map("cart_id")
  userId    Int      @map("user_id")
  createdAt DateTime @default(now()) @map("created_at")

  // Relations
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  items     CartItem[]

  @@map("carts")
}

model CartItem {
  id        Int      @id @default(autoincrement()) @map("cart_item_id")
  cartId    Int      @map("cart_id")
  productId Int      @map("product_id")
  quantity  Int      @default(1)

  // Relations
  cart      Cart     @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@map("cart_items")
}

model Order {
  id        Int      @id @default(autoincrement()) @map("order_id")
  userId    Int      @map("user_id")
  total     Decimal  @db.Decimal(15, 2)
  createdAt DateTime @default(now()) @map("created_at")

  // Relations
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  details   OrderDetail[]

  @@map("orders")
}

model OrderDetail {
  id            Int      @id @default(autoincrement()) @map("order_detail_id")
  orderId       Int      @map("order_id")
  productId     Int      @map("product_id")
  quantity      Int
  priceSnapshot Decimal  @map("price_snapshot") @db.Decimal(12, 2)
  total         Decimal  @db.Decimal(15, 2)

  // Relations
  order         Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product       Product  @relation(fields: [productId], references: [id], onDelete: Restrict)

  @@map("order_details")
}